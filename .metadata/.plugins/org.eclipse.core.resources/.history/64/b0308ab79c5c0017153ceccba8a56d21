package com.study.mvc.tools;

import java.io.IOException;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Properties;

import com.mchange.v2.c3p0.ComboPooledDataSource;

public class DBUtil {
	private ComboPooledDataSource ds;
	
	private DBUtil(){
	}
	private Connection getConnection(){
		try {
			Class.forName(driver);
			conn = ds.getConnection(url);;
		} catch (ClassNotFoundException e) {
			errInfo = "没有找到JDBC驱动";
			System.out.println(errInfo);
			e.printStackTrace();
		} catch (SQLException e) {
			errInfo = "创建数据库连接失败";
			System.out.println(errInfo);
			e.printStackTrace();
		}
		return conn;
	}
	
	
	//DBUtil.getJDBC().getConn();
	public Connection getConn(){
		return conn;
	}
	public  ResultSet queryData(String sql, ArrayList<Object> objList){
		ResultSet rs = null;
		if(errInfo!=null){
			return rs;
		}
		try {
			PreparedStatement ps = conn.prepareStatement(sql);
			if(objList!=null){
				for(int i=0; i<objList.size();i++){
					ps.setObject(i+1, objList.get(i));
					System.out.println("i对象为" + objList.get(i));
				}
			}
			System.out.println("sql执行语句为:" + sql);
			rs = ps.executeQuery();
		} catch (SQLException e1) {
			errInfo = "查询sql执行失败";
			System.out.println(errInfo);
			e1.printStackTrace();
		}
		return rs;
	}
	
	
	public  int updateSql(String sql,  ArrayList<Object> objList){
		int ret = 0;
		try {
			PreparedStatement ps = conn.prepareStatement(sql);
			if(objList!=null){
				for(int i=0; i<objList.size();i++){
					ps.setObject(i+1, objList.get(i));
					System.out.println("i对象为" + objList.get(i));
				}
			}
			ret = ps.executeUpdate();
			System.out.println("增删改执行的sql 是" + sql);
		} catch (SQLException e) {
			errInfo = "增删该sql执行失败 sql 为:" + sql;
			System.out.println(errInfo);
			e.printStackTrace();
		}
		return ret;
	}
	
}
